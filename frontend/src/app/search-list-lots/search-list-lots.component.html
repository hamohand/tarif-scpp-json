<div class="search-container">
<!-- Section démarche à suivre -->
<div *ngIf="!isSaved">
    <h3>Démarche à suivre (Openai gpt4.1)</h3>
    <ol><li>Création ou mise à jour du fichier de données</li>
    <li>Chargement du fichier</li>
    <li>Lancement de la recherche</li>
    <li>Création automatique et enregistrement du fichier résultant de la recherche</li></ol>
</div>
<hr style="width: 66%">
    <!-- Section pour charger le fichier -->
<div *ngIf="lesarticles.length == 0" class="file-upload-container">
    <h4>1. Créer ou mettre à jour le fichier de données</h4>
    <ul>
        <li>il doit contenir une colonne à en-tête '<b>article</b>' pour les descriptions des articles</li>
        <li>il doit contenir une colonne à en-tête '<b>code</b>', cette colonne est laissée vide elle sera remplie par l'application dans le fichier résultat.</li>
        <li><b>type</b> accepté : <b>-</b> Excel (.xls, .xlsx) <b>-</b> LibreOffice (.ods) <b>-</b> Les fichiers au format CSV avec la <code>tabulation</code> comme délimiteur (.csv ou .tsv) <b>-</b> Les fichiers Google Sheets sont convertis en '.tsv'.</li>
    </ul>

    <h4>2. Charger le fichier de données</h4>
            <ul>
                <li>choisir l'emplacement du fichier de données,</li>
                <li>le sélectionner et cliquez sur 'Ouvrir'.</li></ul>

    <input type="file" (change)="onFileSelected($event)" accept=".csv, .tsv, .xls, .xlsx, .ods" />
    <div *ngIf="isLoading && !isSearchComplete" class="loading-message">
        Chargement du fichier en cours...
    </div>
</div>

<!-- Le reste de l'interface est affiché seulement si un fichier est chargé -->
    <div *ngIf="lesarticles.length > 0 && !isSearchComplete">
    <hr>
    <h3>3. Lancer la recherche</h3>
    <p>Fichier chargé : <strong>{{ fileName }}</strong></p>

    <h3  *ngIf="!isSearchComplete">Données du fichier :</h3>
    <table  *ngIf="!isSearchComplete" class="couleurFond" border="0" width="70%">
        <tbody>
        <tr *ngFor="let e of lesarticles">
            <td>
                <!-- contenu : -->
                {{e.article}} : {{e.code}}
            </td>
        </tr>
        </tbody>
    </table>

    <div class="search-form">
        <button
                (click)="search()"
                [disabled]="isLoading"
                class="search-button"
        >
            {{ isLoading ? 'Recherche en cours...' : 'Lancer la recherche des codes' }}
        </button>
    </div></div>

<!-- Ce bouton n'apparaît qu'une fois la recherche terminée -->
        <div  *ngIf="isSearchComplete && !isLoading && !isSaved">
        <h3>4. Création automatique du fichier résultat de la recherche</h3>
        Le fichier résultat est toujours au format CSV avec la tabulation comme délimiteur (.tsv). Il porte le nom du fichier de données précédé de "<code>resultat-</code>" et son extension est toujous '.tsv".
        Dans la boîte de dialogue :
            <ul>
                <li>choisir l'emplacement du fichier résultat,</li>
                <li>cliquez sur `Enregistrer`.</li></ul>
        <button
                *ngIf="isSearchComplete && !isLoading"
                (click)="saveAndDownload()"
                class="save-button"
        >
            Enregistrer et Télécharger les résultats
        </button>

    <div *ngIf="error" class="error-message">
        {{ error }}
    </div>

    <h4 *ngIf="isSearchComplete">- Données mises à jour :</h4>
    <table class="couleurFond" border="0" width="70%" *ngIf="isSearchComplete">
        <tbody>
        <tr *ngFor="let e of lesarticles">
            <td>
                <!-- contenu : -->
                {{e.article}} : {{e.code}}
            </td>
        </tr>
        </tbody>
    </table>
   </div>
<h4 *ngIf="isSaved">** Votre fichier a été enregistré, vous pouvez maintenant l'utiliser.</h4>

</div>


